- name: group | raspberrypi | Update cgroup options
  loop:
    - cgroup_enable=memory
    - cgroup_memory=1
  loop_control:
    loop_var: cgroup_option
  when: cgroup_option not in lookup('ansible.builtin.file', cmdline_path)
  notify: reboot
  vars:
    cmdline_path: /boot/firmware/cmdline.txt
  ansible.builtin.lineinfile:
    path: "{{ cmdline_path }}"
    regexp: '^.*$'
    line: "\\1 {{ cgroup_option }}"
    backrefs: true

- name: group | raspberrypi | Flush handlers
  ansible.builtin.meta: flush_handlers
